{"version":3,"sources":["../src/netxms_objects_list_directive.js"],"names":["angular","module","directive","restrict","scope","getList","selectedItem","name","inputPlaceholder","onSelection","template","link","element","pressedDropdown","activeItemIndex","_","isEmpty","id","inputValue","dropdownVisible","$watch","newValue","oldValue","equals","setActive","itemIndex","inputChange","getFilteredList","inputFocus","showDropdown","inputBlur","event","selectActiveItem","hideDropdown","dropdownPressed","selectItem","item","console","log","filterString","then","items","dropdownItems","filter","toLowerCase","includes","selectPreviousItem","prevIndex","selectNextItem","nextIndex","length","bind","which","$apply","preventDefault"],"mappings":"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","sourcesContent":["import angular from 'angular';\nimport _ from 'lodash';\n\nangular.module('grafana.directives').directive('netxmsObjectList', function()\n{\n\n   return {\n      restrict: 'E',\n      scope:\n         {\n            getList: '&',\n            selectedItem: '=',\n            name: '@',\n            inputPlaceholder: '@',\n            onSelection: '&'\n         },\n      template: '<div class=\"netxms-object-list\">' +\n         '<input type=\"text\"' +\n         'spellcheck=\"false\"' +\n         'name=\"{{name}}\"' +\n         'placeholder=\"{{inputPlaceholder}}\"' +\n         'ng-model=\"inputValue\"' +\n         'ng-change=\"inputChange()\"' +\n         'ng-focus=\"inputFocus()\"' +\n         'ng-blur=\"inputBlur($event)\"' +\n         'class=\"gf-form-input' +\n         ' width-25\"' +\n         'autocomplete=\"off\"' +\n         'input>' +\n         '<ul ng-show=\"dropdownVisible\">' +\n         '<li ng-repeat=\"item in dropdownItems\"' +\n         'ng-click=\"selectItem(item)\"' +\n         'ng-mouseenter=\"setActive($index)\"' +\n         'ng-mousedown=\"dropdownPressed()\"' +\n         'ng-class=\"{\\'active\\': activeItemIndex === $index}\"' +\n         '>' +\n         '<span>{{item.name}}</span>' +\n         '</li>' +\n         '</ul>' +\n         '</div>',\n      link: function(scope, element)\n      {\n         var pressedDropdown = false;\n         scope.activeItemIndex = -1;\n         scope.selectedItem = _.isEmpty(scope.selectedItem) ? {name: \"\", id: 0} : scope.selectedItem;\n         scope.inputValue = scope.selectedItem.name;\n         scope.dropdownVisible = false;\n\n         scope.$watch('dropdownItems', function(newValue, oldValue)\n         {\n            if (!angular.equals(newValue, oldValue))\n               scope.setActive(-1);\n         });\n\n         scope.$watch('selectedItem', function(newValue, oldValue)\n         {\n            if (!angular.equals(newValue, oldValue))\n            {\n               if (newValue)\n               {\n                  scope.inputValue = newValue.name;\n                  scope.onSelection();\n               }\n            }\n         });\n\n         scope.setActive = function(itemIndex)\n         {\n            scope.activeItemIndex = itemIndex;\n         };\n\n         scope.inputChange = function()\n         {\n            getFilteredList(scope.inputValue);\n         };\n\n         scope.inputFocus = function()\n         {\n            getFilteredList(scope.inputValue);\n            showDropdown();\n         };\n\n         scope.inputBlur = function(event)\n         {\n            selectActiveItem();\n            if (pressedDropdown)\n            {\n               pressedDropdown = false;\n            }\n            hideDropdown();\n         };\n\n         scope.dropdownPressed = function()\n         {\n            pressedDropdown = true;\n         }\n\n         scope.selectItem = function(item)\n         {\n            scope.selectedItem = item;\n            console.log(item);\n            hideDropdown();\n         };\n\n         var getFilteredList = function(filterString)\n         {\n            scope.getList().then(function(items)\n            {\n               scope.dropdownItems = _.filter(items, function(item)\n               {\n                  return (filterString == null ? true : item.name.toLowerCase().includes(filterString.toLowerCase()));\n               });\n            });\n         };\n\n         var showDropdown = function ()\n         {\n            scope.dropdownVisible = true;\n         };\n\n         var hideDropdown = function()\n         {\n            scope.dropdownVisible = false;\n         };\n\n         var selectPreviousItem = function()\n         {\n            var prevIndex = scope.activeItemIndex - 1;\n            if (prevIndex >= -1)\n               scope.setActive(prevIndex);\n         };\n\n         var selectNextItem = function()\n         {\n            var nextIndex = scope.activeItemIndex + 1;\n            if (nextIndex < scope.dropdownItems.length)\n               scope.setActive(nextIndex);\n         };\n\n         var selectActiveItem = function()\n         {\n            if (scope.activeItemIndex >= 0)\n               scope.selectItem(scope.dropdownItems[scope.activeItemIndex]);\n            else\n               scope.selectItem({name: scope.inputValue, id: 0});\n         };\n\n         element.bind(\"keydown keypress\", function (event)\n         {\n            switch (event.which)\n            {\n               case 38: //up\n                  scope.$apply(selectPreviousItem);\n                  break;\n               case 40: //down\n                  scope.$apply(selectNextItem);\n                  break;\n               case 13: // return\n                  event.preventDefault();\n                  scope.$apply(selectActiveItem);\n                  break;\n            }\n         });\n      }\n   }\n});"],"file":"netxms_objects_list_directive.js"}