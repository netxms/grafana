{"version":3,"sources":["../src/netxms_objects_list_directive.js"],"names":["angular","_","module","directive","restrict","scope","getList","selectedItem","name","inputPlaceholder","onSelection","template","link","element","pressedDropdown","activeItemIndex","isEmpty","id","console","log","inputValue","dropdownVisible","$watch","newValue","oldValue","equals","setActive","itemIndex","inputChange","getFilteredList","showDropdown","inputFocus","inputBlur","event","selectActiveItem","hideDropdown","dropdownPressed","selectItem","item","filterString","then","items","dropdownItems","filter","toLowerCase","includes","selectPreviousItem","prevIndex","selectNextItem","nextIndex","length","bind","which","$apply","preventDefault"],"mappings":";;;;;;;;;AAAOA,a;;AACAC,O;;;;AAEPD,cAAQE,MAAR,CAAe,oBAAf,EAAqCC,SAArC,CAA+C,kBAA/C,EAAmE,YACnE;;AAEE,eAAO;AACLC,oBAAU,GADL;AAELC,iBACA;AACEC,qBAAS,GADX;AAEEC,0BAAc,GAFhB;AAGEC,kBAAM,GAHR;AAIEC,8BAAkB,GAJpB;AAKEC,yBAAa;AALf,WAHK;AAULC,oBAAU,qCACE,oBADF,GAEM,oBAFN,GAGM,iBAHN,GAIM,oCAJN,GAKM,uBALN,GAMM,2BANN,GAOM,yBAPN,GAQM,6BARN,GASM,sBATN,GAUM,YAVN,GAWM,oBAXN,GAYM,QAZN,GAaA,gCAbA,GAcE,uCAdF,GAeM,6BAfN,GAgBM,mCAhBN,GAiBM,kCAjBN,GAkBM,qDAlBN,GAmBM,GAnBN,GAoBI,4BApBJ,GAqBE,OArBF,GAsBA,OAtBA,GAuBF,QAjCH;AAkCLC,gBAAM,cAASP,KAAT,EAAgBQ,OAAhB,EACN;AACE,gBAAIC,kBAAkB,KAAtB;AACAT,kBAAMU,eAAN,GAAwB,CAAxB;AACAV,kBAAME,YAAN,GAAqBN,EAAEe,OAAF,CAAUX,MAAME,YAAhB,IAAgC,EAACC,MAAM,EAAP,EAAWS,IAAI,CAAf,EAAhC,GAAoDZ,MAAME,YAA/E;AACAW,oBAAQC,GAAR,CAAYd,MAAME,YAAlB;AACAF,kBAAMe,UAAN,GAAmBf,MAAME,YAAN,CAAmBC,IAAtC;AACAH,kBAAMgB,eAAN,GAAwB,KAAxB;;AAEAhB,kBAAMiB,MAAN,CAAa,eAAb,EAA8B,UAASC,QAAT,EAAmBC,QAAnB,EAC9B;AACE,kBAAI,CAACxB,QAAQyB,MAAR,CAAeF,QAAf,EAAyBC,QAAzB,CAAL,EACEnB,MAAMqB,SAAN,CAAgB,CAAC,CAAjB;AACH,aAJD;;AAMArB,kBAAMiB,MAAN,CAAa,cAAb,EAA6B,UAASC,QAAT,EAAmBC,QAAnB,EAC7B;AACE,kBAAI,CAACxB,QAAQyB,MAAR,CAAeF,QAAf,EAAyBC,QAAzB,CAAL,EACA;AACE,oBAAID,QAAJ,EACA;AACElB,wBAAMe,UAAN,GAAmBG,SAASf,IAA5B;AACAH,wBAAMK,WAAN;AACD;AACF;AACF,aAVD;;AAYAL,kBAAMqB,SAAN,GAAkB,UAASC,SAAT,EAClB;AACEtB,oBAAMU,eAAN,GAAwBY,SAAxB;AACD,aAHD;;AAKAtB,kBAAMuB,WAAN,GAAoB,YACpB;AACEvB,oBAAME,YAAN,GAAqB,EAArB;AACAsB,8BAAgBxB,MAAMe,UAAtB;AACAU;AACD,aALD;;AAOAzB,kBAAM0B,UAAN,GAAmB,YACnB;AACEF;AACAxB,oBAAMqB,SAAN,CAAgB,CAAC,CAAjB;AACAI;AACD,aALD;;AAOAzB,kBAAM2B,SAAN,GAAkB,UAASC,KAAT,EAClB;AACEC;AACA,kBAAIpB,eAAJ,EACA;AACEA,kCAAkB,KAAlB;AACA;AACD;AACDqB;AACD,aATD;;AAWA9B,kBAAM+B,eAAN,GAAwB,YACxB;AACEtB,gCAAkB,IAAlB;AACD,aAHD;;AAKAT,kBAAMgC,UAAN,GAAmB,UAASC,IAAT,EACnB;AACEjC,oBAAME,YAAN,GAAqB+B,IAArB;AACAH;AACD,aAJD;;AAMA,gBAAIN,kBAAkB,SAAlBA,eAAkB,CAASU,YAAT,EACtB;AACElC,oBAAMC,OAAN,GAAgBkC,IAAhB,CAAqB,UAASC,KAAT,EACrB;AACIpC,sBAAMqC,aAAN,GAAsBzC,EAAE0C,MAAF,CAASF,KAAT,EAAgB,UAASH,IAAT,EACpC;AACE,yBAAQC,gBAAgB,IAAhB,GAAuB,IAAvB,GAA8BD,KAAK9B,IAAL,CAAUoC,WAAV,GAAwBC,QAAxB,CAAiCN,aAAaK,WAAb,EAAjC,CAAtC;AACD,iBAHmB,CAAtB;AAIH,eAND;AAOD,aATD;;AAWA,gBAAId,eAAe,SAAfA,YAAe,GACnB;AACEzB,oBAAMgB,eAAN,GAAwB,IAAxB;AACD,aAHD;;AAKA,gBAAIc,eAAe,SAAfA,YAAe,GACnB;AACE9B,oBAAMgB,eAAN,GAAwB,KAAxB;AACD,aAHD;;AAKA,gBAAIyB,qBAAqB,SAArBA,kBAAqB,GACzB;AACE,kBAAIC,YAAY1C,MAAMU,eAAN,GAAwB,CAAxC;AACA,kBAAIgC,aAAa,CAAC,CAAlB,EACE1C,MAAMqB,SAAN,CAAgBqB,SAAhB;AACH,aALD;;AAOA,gBAAIC,iBAAiB,SAAjBA,cAAiB,GACrB;AACE,kBAAIC,YAAY5C,MAAMU,eAAN,GAAwB,CAAxC;AACA,kBAAIkC,YAAY5C,MAAMqC,aAAN,CAAoBQ,MAApC,EACE7C,MAAMqB,SAAN,CAAgBuB,SAAhB;AACH,aALD;;AAOA,gBAAIf,mBAAmB,SAAnBA,gBAAmB,GACvB;AACE,kBAAI7B,MAAMU,eAAN,IAAyB,CAAzB,IAA8BV,MAAMU,eAAN,GAAwBV,MAAMqC,aAAN,CAAoBQ,MAA9E,EACE7C,MAAMgC,UAAN,CAAiBhC,MAAMqC,aAAN,CAAoBrC,MAAMU,eAA1B,CAAjB,EADF,KAGEV,MAAMgC,UAAN,CAAiB,EAAC7B,MAAMH,MAAMe,UAAN,GAAmBf,MAAMe,UAAzB,GAAsC,EAA7C,EAAiDH,IAAI,CAArD,EAAjB;AACH,aAND;;AAQAJ,oBAAQsC,IAAR,CAAa,kBAAb,EAAiC,UAAUlB,KAAV,EACjC;AACE,sBAAQA,MAAMmB,KAAd;AAEE,qBAAK,EAAL;AAAS;AACP/C,wBAAMgD,MAAN,CAAaP,kBAAb;AACA;AACF,qBAAK,EAAL;AAAS;AACPzC,wBAAMgD,MAAN,CAAaL,cAAb;AACA;AACF,qBAAK,EAAL;AAAS;AACP;AACA;AACEf,wBAAMqB,cAAN;AACAjD,wBAAMgD,MAAN,CAAanB,gBAAb;AACF;AACA;AAdJ;AAgBD,aAlBD;AAmBD;AApKI,SAAP;AAsKD,OAzKD","file":"netxms_objects_list_directive.js","sourcesContent":["import angular from 'angular';\nimport _ from 'lodash';\n\nangular.module('grafana.directives').directive('netxmsObjectList', function()\n{\n\n  return {\n    restrict: 'E',\n    scope:\n    {\n      getList: '&',\n      selectedItem: '=',\n      name: '@',\n      inputPlaceholder: '@',\n      onSelection: '&'\n    },\n    template: '<div class=\"netxms-object-list\">' +\n                '<input type=\"text\"' +\n                    'spellcheck=\"false\"' +\n                    'name=\"{{name}}\"' +\n                    'placeholder=\"{{inputPlaceholder}}\"' +\n                    'ng-model=\"inputValue\"' +\n                    'ng-change=\"inputChange()\"' +\n                    'ng-focus=\"inputFocus()\"' +\n                    'ng-blur=\"inputBlur($event)\"' +\n                    'class=\"gf-form-input' +\n                    ' width-25\"' +\n                    'autocomplete=\"off\"' +\n                    'input>' +\n              '<ul ng-show=\"dropdownVisible\">' +\n                '<li ng-repeat=\"item in dropdownItems\"' +\n                    'ng-click=\"selectItem(item)\"' +\n                    'ng-mouseenter=\"setActive($index)\"' +\n                    'ng-mousedown=\"dropdownPressed()\"' +\n                    'ng-class=\"{\\'active\\': activeItemIndex === $index}\"' +\n                    '>' +\n                  '<span>{{item.name}}</span>' +\n                '</li>' +\n              '</ul>' +\n            '</div>',\n    link: function(scope, element)\n    {\n      var pressedDropdown = false;\n      scope.activeItemIndex = 0;\n      scope.selectedItem = _.isEmpty(scope.selectedItem) ? {name: \"\", id: 0} : scope.selectedItem;\n      console.log(scope.selectedItem);\n      scope.inputValue = scope.selectedItem.name;\n      scope.dropdownVisible = false;\n\n      scope.$watch('dropdownItems', function(newValue, oldValue)\n      {\n        if (!angular.equals(newValue, oldValue))\n          scope.setActive(-1);\n      });\n\n      scope.$watch('selectedItem', function(newValue, oldValue)\n      {\n        if (!angular.equals(newValue, oldValue))\n        {\n          if (newValue)\n          {\n            scope.inputValue = newValue.name;\n            scope.onSelection();\n          }\n        }\n      });\n\n      scope.setActive = function(itemIndex)\n      {\n        scope.activeItemIndex = itemIndex;\n      };\n\n      scope.inputChange = function()\n      {\n        scope.selectedItem = {};\n        getFilteredList(scope.inputValue);\n        showDropdown();\n      };\n\n      scope.inputFocus = function()\n      {\n        getFilteredList();\n        scope.setActive(-1);\n        showDropdown();\n      };\n\n      scope.inputBlur = function(event)\n      {\n        selectActiveItem();\n        if (pressedDropdown)\n        {\n          pressedDropdown = false;\n          return;\n        }\n        hideDropdown();\n      };\n\n      scope.dropdownPressed = function()\n      {\n        pressedDropdown = true;\n      }\n\n      scope.selectItem = function(item)\n      {\n        scope.selectedItem = item;\n        hideDropdown();\n      };\n\n      var getFilteredList = function(filterString)\n      {\n        scope.getList().then(function(items)\n        {\n            scope.dropdownItems = _.filter(items, function(item) \n              { \n                return (filterString == null ? true : item.name.toLowerCase().includes(filterString.toLowerCase())); \n              });\n        });\n      };\n\n      var showDropdown = function ()\n      {\n        scope.dropdownVisible = true;\n      };\n\n      var hideDropdown = function()\n      {\n        scope.dropdownVisible = false;\n      };\n\n      var selectPreviousItem = function()\n      {\n        var prevIndex = scope.activeItemIndex - 1;\n        if (prevIndex >= -1)\n          scope.setActive(prevIndex);\n      };\n\n      var selectNextItem = function()\n      {\n        var nextIndex = scope.activeItemIndex + 1;\n        if (nextIndex < scope.dropdownItems.length)\n          scope.setActive(nextIndex);\n      };\n\n      var selectActiveItem = function() \n      {\n        if (scope.activeItemIndex >= 0 && scope.activeItemIndex < scope.dropdownItems.length)\n          scope.selectItem(scope.dropdownItems[scope.activeItemIndex]);\n        else\n          scope.selectItem({name: scope.inputValue ? scope.inputValue : \"\", id: 0});\n      };\n\n      element.bind(\"keydown keypress\", function (event)\n      {\n        switch (event.which)\n        {\n          case 38: //up\n            scope.$apply(selectPreviousItem);\n            break;\n          case 40: //down\n            scope.$apply(selectNextItem);\n            break;\n          case 13: // return\n            //if (scope.dropdownVisible && scope.dropdownItems && scope.dropdownItems.length > 0)\n            //{\n              event.preventDefault();\n              scope.$apply(selectActiveItem);\n            //}\n            break;\n        }\n      });\n    }\n  }\n});"]}