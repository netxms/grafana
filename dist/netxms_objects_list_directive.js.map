{"version":3,"sources":["../src/netxms_objects_list_directive.js"],"names":["angular","_","module","directive","restrict","scope","getList","selectedItem","name","inputPlaceholder","onSelection","template","link","element","pressedDropdown","activeItemIndex","isEmpty","id","inputValue","dropdownVisible","$watch","newValue","oldValue","equals","setActive","itemIndex","inputChange","getFilteredList","inputFocus","showDropdown","inputBlur","event","selectActiveItem","hideDropdown","dropdownPressed","selectItem","item","console","log","filterString","then","items","dropdownItems","filter","toLowerCase","includes","selectPreviousItem","prevIndex","selectNextItem","nextIndex","length","bind","which","$apply","preventDefault"],"mappings":"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","file":"netxms_objects_list_directive.js","sourcesContent":["import angular from 'angular';\nimport _ from 'lodash';\n\nangular.module('grafana.directives').directive('netxmsObjectList', function()\n{\n\n   return {\n      restrict: 'E',\n      scope:\n         {\n            getList: '&',\n            selectedItem: '=',\n            name: '@',\n            inputPlaceholder: '@',\n            onSelection: '&'\n         },\n      template: '<div class=\"netxms-object-list\">' +\n         '<input type=\"text\"' +\n         'spellcheck=\"false\"' +\n         'name=\"{{name}}\"' +\n         'placeholder=\"{{inputPlaceholder}}\"' +\n         'ng-model=\"inputValue\"' +\n         'ng-change=\"inputChange()\"' +\n         'ng-focus=\"inputFocus()\"' +\n         'ng-blur=\"inputBlur($event)\"' +\n         'class=\"gf-form-input' +\n         ' width-25\"' +\n         'autocomplete=\"off\"' +\n         'input>' +\n         '<ul ng-show=\"dropdownVisible\">' +\n         '<li ng-repeat=\"item in dropdownItems\"' +\n         'ng-click=\"selectItem(item)\"' +\n         'ng-mouseenter=\"setActive($index)\"' +\n         'ng-mousedown=\"dropdownPressed()\"' +\n         'ng-class=\"{\\'active\\': activeItemIndex === $index}\"' +\n         '>' +\n         '<span>{{item.name}}</span>' +\n         '</li>' +\n         '</ul>' +\n         '</div>',\n      link: function(scope, element)\n      {\n         var pressedDropdown = false;\n         scope.activeItemIndex = -1;\n         scope.selectedItem = _.isEmpty(scope.selectedItem) ? {name: \"\", id: 0} : scope.selectedItem;\n         scope.inputValue = scope.selectedItem.name;\n         scope.dropdownVisible = false;\n\n         scope.$watch('dropdownItems', function(newValue, oldValue)\n         {\n            if (!angular.equals(newValue, oldValue))\n               scope.setActive(-1);\n         });\n\n         scope.$watch('selectedItem', function(newValue, oldValue)\n         {\n            if (!angular.equals(newValue, oldValue))\n            {\n               if (newValue)\n               {\n                  scope.inputValue = newValue.name;\n                  scope.onSelection();\n               }\n            }\n         });\n\n         scope.setActive = function(itemIndex)\n         {\n            scope.activeItemIndex = itemIndex;\n         };\n\n         scope.inputChange = function()\n         {\n            getFilteredList(scope.inputValue);\n         };\n\n         scope.inputFocus = function()\n         {\n            getFilteredList(scope.inputValue);\n            showDropdown();\n         };\n\n         scope.inputBlur = function(event)\n         {\n            selectActiveItem();\n            if (pressedDropdown)\n            {\n               pressedDropdown = false;\n            }\n            hideDropdown();\n         };\n\n         scope.dropdownPressed = function()\n         {\n            pressedDropdown = true;\n         }\n\n         scope.selectItem = function(item)\n         {\n            scope.selectedItem = item;\n            console.log(item);\n            hideDropdown();\n         };\n\n         var getFilteredList = function(filterString)\n         {\n            scope.getList().then(function(items)\n            {\n               scope.dropdownItems = _.filter(items, function(item)\n               {\n                  return (filterString == null ? true : item.name.toLowerCase().includes(filterString.toLowerCase()));\n               });\n            });\n         };\n\n         var showDropdown = function ()\n         {\n            scope.dropdownVisible = true;\n         };\n\n         var hideDropdown = function()\n         {\n            scope.dropdownVisible = false;\n         };\n\n         var selectPreviousItem = function()\n         {\n            var prevIndex = scope.activeItemIndex - 1;\n            if (prevIndex >= -1)\n               scope.setActive(prevIndex);\n         };\n\n         var selectNextItem = function()\n         {\n            var nextIndex = scope.activeItemIndex + 1;\n            if (nextIndex < scope.dropdownItems.length)\n               scope.setActive(nextIndex);\n         };\n\n         var selectActiveItem = function()\n         {\n            if (scope.activeItemIndex >= 0)\n               scope.selectItem(scope.dropdownItems[scope.activeItemIndex]);\n            else\n               scope.selectItem({name: scope.inputValue, id: 0});\n         };\n\n         element.bind(\"keydown keypress\", function (event)\n         {\n            switch (event.which)\n            {\n               case 38: //up\n                  scope.$apply(selectPreviousItem);\n                  break;\n               case 40: //down\n                  scope.$apply(selectNextItem);\n                  break;\n               case 13: // return\n                  event.preventDefault();\n                  scope.$apply(selectActiveItem);\n                  break;\n            }\n         });\n      }\n   }\n});"]}