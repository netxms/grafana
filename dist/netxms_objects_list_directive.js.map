{"version":3,"sources":["../src/netxms_objects_list_directive.js"],"names":["angular","_","module","directive","restrict","scope","getList","selectedItem","name","inputPlaceholder","onSelection","template","link","element","pressedDropdown","activeItemIndex","inputValue","dropdownVisible","$watch","newValue","oldValue","equals","setActive","itemIndex","inputChange","getFilteredList","showDropdown","inputFocus","inputBlur","event","hideDropdown","dropdownPressed","selectItem","item","filterString","then","items","dropdownItems","filter","toLowerCase","includes","selectPreviousItem","prevIndex","selectNextItem","nextIndex","length","selectActiveItem","bind","which","$apply","preventDefault"],"mappings":"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","file":"netxms_objects_list_directive.js","sourcesContent":["import angular from 'angular';\nimport _ from 'lodash';\n\nangular.module('grafana.directives').directive('netxmsObjectList', function()\n{\n\n  return {\n    restrict: 'E',\n    scope:\n    {\n      getList: '&',\n      selectedItem: '=',\n      name: '@',\n      inputPlaceholder: '@',\n      onSelection: '&'\n    },\n    template: '<div class=\"netxms-object-list\">' +\n                '<input type=\"text\"' +\n                    'spellcheck=\"false\"' +\n                    'name=\"{{name}}\"' +\n                    'placeholder=\"{{inputPlaceholder}}\"' +\n                    'ng-model=\"inputValue\"' +\n                    'ng-change=\"inputChange()\"' +\n                    'ng-focus=\"inputFocus()\"' +\n                    'ng-blur=\"inputBlur($event)\"' +\n                    'class=\"gf-form-input' +\n                    ' width-25\"' +\n                    'input>' +\n              '<ul ng-show=\"dropdownVisible\">' +\n                '<li ng-repeat=\"item in dropdownItems\"' +\n                    'ng-click=\"selectItem(item)\"' +\n                    'ng-mouseenter=\"setActive($index)\"' +\n                    'ng-mousedown=\"dropdownPressed()\"' +\n                    'ng-class=\"{\\'active\\': activeItemIndex === $index}\"' +\n                    '>' +\n                  '<span>{{item.name}}</span>' +\n                '</li>' +\n              '</ul>' +\n            '</div>',\n    link: function(scope, element)\n    {\n      var pressedDropdown = false;\n      scope.activeItemIndex = 0;\n      scope.inputValue = scope.selectedItem ? scope.selectedItem.name : '';\n      scope.dropdownVisible = false;\n\n      scope.$watch('dropdownItems', function(newValue, oldValue)\n      {\n        if (!angular.equals(newValue, oldValue))\n          scope.setActive(0);\n      });\n\n      scope.$watch('selectedItem', function(newValue, oldValue)\n      {\n        if (!angular.equals(newValue, oldValue))\n        {\n          if (newValue)\n          {\n            scope.inputValue = newValue.name;\n            scope.onSelection();\n          }\n        }\n      });\n\n      scope.setActive = function(itemIndex)\n      {\n        scope.activeItemIndex = itemIndex;\n      };\n\n      scope.inputChange = function()\n      {\n        scope.selectedItem = {};\n        getFilteredList(scope.inputValue);\n        showDropdown();\n      };\n\n      scope.inputFocus = function()\n      {\n        getFilteredList();\n        scope.setActive(0);\n        showDropdown();\n      };\n\n      scope.inputBlur = function(event)\n      {\n        if (pressedDropdown)\n        {\n          pressedDropdown = false;\n          return;\n        }\n        hideDropdown();\n      };\n\n      scope.dropdownPressed = function()\n      {\n        pressedDropdown = true;\n      }\n\n      scope.selectItem = function(item)\n      {\n        scope.selectedItem = item;\n        hideDropdown();\n      };\n\n      var getFilteredList = function(filterString)\n      {\n        scope.getList().then(function(items)\n        {\n            scope.dropdownItems = _.filter(items, function(item) \n              { \n                return (filterString == null ? true : item.name.toLowerCase().includes(filterString.toLowerCase())); \n              });\n        });\n      };\n\n      var showDropdown = function ()\n      {\n        scope.dropdownVisible = true;\n      };\n\n      var hideDropdown = function()\n      {\n        scope.dropdownVisible = false;\n      };\n\n      var selectPreviousItem = function()\n      {\n        var prevIndex = scope.activeItemIndex - 1;\n        if (prevIndex >= 0)\n          scope.setActive(prevIndex);\n      };\n\n      var selectNextItem = function()\n      {\n        var nextIndex = scope.activeItemIndex + 1;\n        if (nextIndex < scope.dropdownItems.length)\n          scope.setActive(nextIndex);\n      };\n\n      var selectActiveItem = function() \n      {\n        if (scope.activeItemIndex >= 0 && scope.activeItemIndex < scope.dropdownItems.length)\n          scope.selectItem(scope.dropdownItems[scope.activeItemIndex]);\n      };\n\n      element.bind(\"keydown keypress\", function (event)\n      {\n        switch (event.which)\n        {\n          case 38: //up\n            scope.$apply(selectPreviousItem);\n            break;\n          case 40: //down\n            scope.$apply(selectNextItem);\n            break;\n          case 13: // return\n            if (scope.dropdownVisible && scope.dropdownItems && scope.dropdownItems.length > 0)\n            {\n              event.preventDefault();\n              scope.$apply(selectActiveItem);\n            }\n            break;\n        }\n      });\n    }\n  }\n});"]}