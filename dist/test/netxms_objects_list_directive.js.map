{"version":3,"sources":["../../src/netxms_objects_list_directive.js"],"names":["module","directive","restrict","scope","getList","selectedItem","name","inputPlaceholder","onSelection","template","link","element","pressedDropdown","activeItemIndex","inputValue","dropdownVisible","$watch","newValue","oldValue","equals","setActive","itemIndex","inputChange","getFilteredList","showDropdown","inputFocus","inputBlur","event","hideDropdown","dropdownPressed","selectItem","item","filterString","then","items","dropdownItems","filter","toLowerCase","includes","selectPreviousItem","prevIndex","selectNextItem","nextIndex","length","selectActiveItem","bind","which","$apply","preventDefault"],"mappings":"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","file":"netxms_objects_list_directive.js","sourcesContent":["import angular from 'angular';\nimport _ from 'lodash';\n\nangular.module('grafana.directives').directive('netxmsObjectList', function()\n{\n\n  return {\n    restrict: 'E',\n    scope:\n    {\n      getList: '&',\n      selectedItem: '=',\n      name: '@',\n      inputPlaceholder: '@',\n      onSelection: '&'\n    },\n    template: '<div class=\"netxms-object-list\">' +\n                '<input type=\"text\"' +\n                    'spellcheck=\"false\"' +\n                    'name=\"{{name}}\"' +\n                    'placeholder=\"{{inputPlaceholder}}\"' +\n                    'ng-model=\"inputValue\"' +\n                    'ng-change=\"inputChange()\"' +\n                    'ng-focus=\"inputFocus()\"' +\n                    'ng-blur=\"inputBlur($event)\"' +\n                    'class=\"gf-form-input' +\n                    ' width-25\"' +\n                    'input>' +\n              '<ul ng-show=\"dropdownVisible\">' +\n                '<li ng-repeat=\"item in dropdownItems\"' +\n                    'ng-click=\"selectItem(item)\"' +\n                    'ng-mouseenter=\"setActive($index)\"' +\n                    'ng-mousedown=\"dropdownPressed()\"' +\n                    'ng-class=\"{\\'active\\': activeItemIndex === $index}\"' +\n                    '>' +\n                  '<span>{{item.name}}</span>' +\n                '</li>' +\n              '</ul>' +\n            '</div>',\n    link: function(scope, element)\n    {\n      var pressedDropdown = false;\n      scope.activeItemIndex = 0;\n      scope.inputValue = scope.selectedItem ? scope.selectedItem.name : '';\n      scope.dropdownVisible = false;\n\n      scope.$watch('dropdownItems', function(newValue, oldValue)\n      {\n        if (!angular.equals(newValue, oldValue))\n          scope.setActive(0);\n      });\n\n      scope.$watch('selectedItem', function(newValue, oldValue)\n      {\n        if (!angular.equals(newValue, oldValue))\n        {\n          if (newValue)\n          {\n            scope.inputValue = newValue.name;\n            scope.onSelection();\n          }\n        }\n      });\n\n      scope.setActive = function(itemIndex)\n      {\n        scope.activeItemIndex = itemIndex;\n      };\n\n      scope.inputChange = function()\n      {\n        scope.selectedItem = {};\n        getFilteredList(scope.inputValue);\n        showDropdown();\n      };\n\n      scope.inputFocus = function()\n      {\n        getFilteredList();\n        scope.setActive(0);\n        showDropdown();\n      };\n\n      scope.inputBlur = function(event)\n      {\n        if (pressedDropdown)\n        {\n          pressedDropdown = false;\n          return;\n        }\n        hideDropdown();\n      };\n\n      scope.dropdownPressed = function()\n      {\n        pressedDropdown = true;\n      }\n\n      scope.selectItem = function(item)\n      {\n        scope.selectedItem = item;\n        hideDropdown();\n      };\n\n      var getFilteredList = function(filterString)\n      {\n        scope.getList().then(function(items)\n        {\n            scope.dropdownItems = _.filter(items, function(item) \n              { \n                return (filterString == null ? true : item.name.toLowerCase().includes(filterString.toLowerCase())); \n              });\n        });\n      };\n\n      var showDropdown = function ()\n      {\n        scope.dropdownVisible = true;\n      };\n\n      var hideDropdown = function()\n      {\n        scope.dropdownVisible = false;\n      };\n\n      var selectPreviousItem = function()\n      {\n        var prevIndex = scope.activeItemIndex - 1;\n        if (prevIndex >= 0)\n          scope.setActive(prevIndex);\n      };\n\n      var selectNextItem = function()\n      {\n        var nextIndex = scope.activeItemIndex + 1;\n        if (nextIndex < scope.dropdownItems.length)\n          scope.setActive(nextIndex);\n      };\n\n      var selectActiveItem = function() \n      {\n        if (scope.activeItemIndex >= 0 && scope.activeItemIndex < scope.dropdownItems.length)\n          scope.selectItem(scope.dropdownItems[scope.activeItemIndex]);\n      };\n\n      element.bind(\"keydown keypress\", function (event)\n      {\n        switch (event.which)\n        {\n          case 38: //up\n            scope.$apply(selectPreviousItem);\n            break;\n          case 40: //down\n            scope.$apply(selectNextItem);\n            break;\n          case 13: // return\n            if (scope.dropdownVisible && scope.dropdownItems && scope.dropdownItems.length > 0)\n            {\n              event.preventDefault();\n              scope.$apply(selectActiveItem);\n            }\n            break;\n        }\n      });\n    }\n  }\n});"]}