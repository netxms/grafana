{"version":3,"sources":["../../src/netxms_objects_list_directive.js"],"names":["angular","module","directive","restrict","scope","getList","selectedItem","name","inputPlaceholder","onSelection","template","link","element","pressedDropdown","activeItemIndex","_","isEmpty","id","inputValue","dropdownVisible","$watch","newValue","oldValue","equals","setActive","itemIndex","inputChange","getFilteredList","inputFocus","showDropdown","inputBlur","event","selectActiveItem","hideDropdown","dropdownPressed","selectItem","item","filterString","then","items","dropdownItems","filter","toLowerCase","includes","selectPreviousItem","prevIndex","selectNextItem","nextIndex","length","bind","which","$apply","preventDefault"],"mappings":"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","file":"netxms_objects_list_directive.js","sourcesContent":["import angular from 'angular';\nimport _ from 'lodash';\n\nangular.module('grafana.directives').directive('netxmsObjectList', function()\n{\n\n   return {\n      restrict: 'E',\n      scope:\n         {\n            getList: '&',\n            selectedItem: '=',\n            name: '@',\n            inputPlaceholder: '@',\n            onSelection: '&'\n         },\n      template: '<div class=\"netxms-object-list\">' +\n         '<input type=\"text\"' +\n         'spellcheck=\"false\"' +\n         'name=\"{{name}}\"' +\n         'placeholder=\"{{inputPlaceholder}}\"' +\n         'ng-model=\"inputValue\"' +\n         'ng-change=\"inputChange()\"' +\n         'ng-focus=\"inputFocus()\"' +\n         'ng-blur=\"inputBlur($event)\"' +\n         'class=\"gf-form-input' +\n         ' width-25\"' +\n         'autocomplete=\"off\"' +\n         'input>' +\n         '<ul ng-show=\"dropdownVisible\">' +\n         '<li ng-repeat=\"item in dropdownItems\"' +\n         'ng-click=\"selectItem(item)\"' +\n         'ng-mouseenter=\"setActive($index)\"' +\n         'ng-mousedown=\"dropdownPressed()\"' +\n         'ng-class=\"{\\'active\\': activeItemIndex === $index}\"' +\n         '>' +\n         '<span>{{item.name}}</span>' +\n         '</li>' +\n         '</ul>' +\n         '</div>',\n      link: function(scope, element)\n      {\n         var pressedDropdown = false;\n         scope.activeItemIndex = 0;\n         scope.selectedItem = _.isEmpty(scope.selectedItem) ? {name: \"\", id: 0} : scope.selectedItem;\n         scope.inputValue = scope.selectedItem.name;\n         scope.dropdownVisible = false;\n\n         scope.$watch('dropdownItems', function(newValue, oldValue)\n         {\n            if (!angular.equals(newValue, oldValue))\n               scope.setActive(-1);\n         });\n\n         scope.$watch('selectedItem', function(newValue, oldValue)\n         {\n            if (!angular.equals(newValue, oldValue))\n            {\n               if (newValue)\n               {\n                  scope.inputValue = newValue.name;\n                  scope.onSelection();\n               }\n            }\n         });\n\n         scope.setActive = function(itemIndex)\n         {\n            scope.activeItemIndex = itemIndex;\n         };\n\n         scope.inputChange = function()\n         {\n            scope.selectedItem = {name: \"\", id: 0};\n            getFilteredList(scope.inputValue);\n            //showDropdown();\n         };\n\n         scope.inputFocus = function()\n         {\n            getFilteredList();\n            showDropdown();\n         };\n\n         scope.inputBlur = function(event)\n         {\n            selectActiveItem();\n            if (pressedDropdown)\n            {\n               pressedDropdown = false;\n               return;\n            }\n            hideDropdown();\n         };\n\n         scope.dropdownPressed = function()\n         {\n            pressedDropdown = true;\n         }\n\n         scope.selectItem = function(item)\n         {\n            scope.selectedItem = item;\n            hideDropdown();\n         };\n\n         var getFilteredList = function(filterString)\n         {\n            scope.getList().then(function(items)\n            {\n               scope.dropdownItems = _.filter(items, function(item)\n               {\n                  return (filterString == null ? true : item.name.toLowerCase().includes(filterString.toLowerCase()));\n               });\n            });\n         };\n\n         var showDropdown = function ()\n         {\n            scope.dropdownVisible = true;\n         };\n\n         var hideDropdown = function()\n         {\n            scope.dropdownVisible = false;\n         };\n\n         var selectPreviousItem = function()\n         {\n            var prevIndex = scope.activeItemIndex - 1;\n            if (prevIndex >= -1)\n               scope.setActive(prevIndex);\n         };\n\n         var selectNextItem = function()\n         {\n            var nextIndex = scope.activeItemIndex + 1;\n            if (nextIndex < scope.dropdownItems.length)\n               scope.setActive(nextIndex);\n         };\n\n         var selectActiveItem = function()\n         {\n            if (scope.activeItemIndex >= 0 && scope.activeItemIndex < scope.dropdownItems.length)\n               scope.selectItem(scope.dropdownItems[scope.activeItemIndex]);\n            else\n               scope.selectItem({name: scope.inputValue ? scope.inputValue : \"\", id: 0});\n         };\n\n         element.bind(\"keydown keypress\", function (event)\n         {\n            switch (event.which)\n            {\n               case 38: //up\n                  scope.$apply(selectPreviousItem);\n                  break;\n               case 40: //down\n                  scope.$apply(selectNextItem);\n                  break;\n               case 13: // return\n                  event.preventDefault();\n                  scope.$apply(selectActiveItem);\n                  break;\n            }\n         });\n      }\n   }\n});"]}