{"version":3,"sources":["../../src/netxms_objects_list_directive.js"],"names":["angular","module","directive","restrict","scope","getList","selectedItem","name","inputPlaceholder","onSelection","template","link","element","pressedDropdown","activeItemIndex","_","isEmpty","id","console","log","inputValue","dropdownVisible","$watch","newValue","oldValue","equals","setActive","itemIndex","inputChange","getFilteredList","showDropdown","inputFocus","inputBlur","event","selectActiveItem","hideDropdown","dropdownPressed","selectItem","item","filterString","then","items","dropdownItems","filter","toLowerCase","includes","selectPreviousItem","prevIndex","selectNextItem","nextIndex","length","bind","which","$apply","preventDefault"],"mappings":"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","file":"netxms_objects_list_directive.js","sourcesContent":["import angular from 'angular';\nimport _ from 'lodash';\n\nangular.module('grafana.directives').directive('netxmsObjectList', function()\n{\n\n  return {\n    restrict: 'E',\n    scope:\n    {\n      getList: '&',\n      selectedItem: '=',\n      name: '@',\n      inputPlaceholder: '@',\n      onSelection: '&'\n    },\n    template: '<div class=\"netxms-object-list\">' +\n                '<input type=\"text\"' +\n                    'spellcheck=\"false\"' +\n                    'name=\"{{name}}\"' +\n                    'placeholder=\"{{inputPlaceholder}}\"' +\n                    'ng-model=\"inputValue\"' +\n                    'ng-change=\"inputChange()\"' +\n                    'ng-focus=\"inputFocus()\"' +\n                    'ng-blur=\"inputBlur($event)\"' +\n                    'class=\"gf-form-input' +\n                    ' width-25\"' +\n                    'autocomplete=\"off\"' +\n                    'input>' +\n              '<ul ng-show=\"dropdownVisible\">' +\n                '<li ng-repeat=\"item in dropdownItems\"' +\n                    'ng-click=\"selectItem(item)\"' +\n                    'ng-mouseenter=\"setActive($index)\"' +\n                    'ng-mousedown=\"dropdownPressed()\"' +\n                    'ng-class=\"{\\'active\\': activeItemIndex === $index}\"' +\n                    '>' +\n                  '<span>{{item.name}}</span>' +\n                '</li>' +\n              '</ul>' +\n            '</div>',\n    link: function(scope, element)\n    {\n      var pressedDropdown = false;\n      scope.activeItemIndex = 0;\n      scope.selectedItem = _.isEmpty(scope.selectedItem) ? {name: \"\", id: 0} : scope.selectedItem;\n      console.log(scope.selectedItem);\n      scope.inputValue = scope.selectedItem.name;\n      scope.dropdownVisible = false;\n\n      scope.$watch('dropdownItems', function(newValue, oldValue)\n      {\n        if (!angular.equals(newValue, oldValue))\n          scope.setActive(-1);\n      });\n\n      scope.$watch('selectedItem', function(newValue, oldValue)\n      {\n        if (!angular.equals(newValue, oldValue))\n        {\n          if (newValue)\n          {\n            scope.inputValue = newValue.name;\n            scope.onSelection();\n          }\n        }\n      });\n\n      scope.setActive = function(itemIndex)\n      {\n        scope.activeItemIndex = itemIndex;\n      };\n\n      scope.inputChange = function()\n      {\n        scope.selectedItem = {};\n        getFilteredList(scope.inputValue);\n        showDropdown();\n      };\n\n      scope.inputFocus = function()\n      {\n        getFilteredList();\n        scope.setActive(-1);\n        showDropdown();\n      };\n\n      scope.inputBlur = function(event)\n      {\n        selectActiveItem();\n        if (pressedDropdown)\n        {\n          pressedDropdown = false;\n          return;\n        }\n        hideDropdown();\n      };\n\n      scope.dropdownPressed = function()\n      {\n        pressedDropdown = true;\n      }\n\n      scope.selectItem = function(item)\n      {\n        scope.selectedItem = item;\n        hideDropdown();\n      };\n\n      var getFilteredList = function(filterString)\n      {\n        scope.getList().then(function(items)\n        {\n            scope.dropdownItems = _.filter(items, function(item) \n              { \n                return (filterString == null ? true : item.name.toLowerCase().includes(filterString.toLowerCase())); \n              });\n        });\n      };\n\n      var showDropdown = function ()\n      {\n        scope.dropdownVisible = true;\n      };\n\n      var hideDropdown = function()\n      {\n        scope.dropdownVisible = false;\n      };\n\n      var selectPreviousItem = function()\n      {\n        var prevIndex = scope.activeItemIndex - 1;\n        if (prevIndex >= -1)\n          scope.setActive(prevIndex);\n      };\n\n      var selectNextItem = function()\n      {\n        var nextIndex = scope.activeItemIndex + 1;\n        if (nextIndex < scope.dropdownItems.length)\n          scope.setActive(nextIndex);\n      };\n\n      var selectActiveItem = function() \n      {\n        if (scope.activeItemIndex >= 0 && scope.activeItemIndex < scope.dropdownItems.length)\n          scope.selectItem(scope.dropdownItems[scope.activeItemIndex]);\n        else\n          scope.selectItem({name: scope.inputValue ? scope.inputValue : \"\", id: 0});\n      };\n\n      element.bind(\"keydown keypress\", function (event)\n      {\n        switch (event.which)\n        {\n          case 38: //up\n            scope.$apply(selectPreviousItem);\n            break;\n          case 40: //down\n            scope.$apply(selectNextItem);\n            break;\n          case 13: // return\n            //if (scope.dropdownVisible && scope.dropdownItems && scope.dropdownItems.length > 0)\n            //{\n              event.preventDefault();\n              scope.$apply(selectActiveItem);\n            //}\n            break;\n        }\n      });\n    }\n  }\n});"]}